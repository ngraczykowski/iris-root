plugins {
  id 'com.silenteight.iris.build.java-base'

  id 'maven-publish'

  id 'org.springframework.boot'
  id 'org.cyclonedx.bom'
}

dependencies {
  implementation libs.spring.boot.starter.web

  testImplementation libs.spring.test
  testImplementation libs.spring.boot.test
  testImplementation libs.spring.boot.test.autoconfigure
}

cyclonedxBom {
  includeConfigs += ["runtimeClasspath"]
  projectType = "application"
  outputName = "${project.name}.bom"
}

jar {
  preserveFileTimestamps false
  reproducibleFileOrder true

  // Generates Class-Path in .jar manifest
  doFirst {
    manifest {
      def runtimeClasspath = configurations.runtimeClasspath

      if (!runtimeClasspath.isEmpty()) {
        def classPathJars = runtimeClasspath.collect {it.getName()}.join(" ")

        attributes "Class-Path": classPathJars
      }
    }
  }
}
