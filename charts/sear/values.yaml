# String to partially override spring.fullname template (will maintain the release name)
nameOverride: ""
# String to fully override spring.fullname template
fullnameOverride: ""

#
# Common for all components
#
serviceAccount:
  # Specifies whether a service account should be created
  create: true
  # Annotations to add to the service account
  annotations: {}
  # The name of the service account to use.
  # If not set and create is true, a name is generated using the fullname template
  name: ""

podAnnotations: {}

podSecurityContext: {}
# fsGroup: 2000

securityContext: {}
# capabilities:
#   drop:
#   - ALL
# readOnlyRootFilesystem: true
# runAsNonRoot: true
# runAsUser: 1000

#
# PostgreSQL database
#
database:
  enabled: true

  volume:
    size: 50Gi

  numberOfInstances: 1

  postgresql:
    version: "12"

#
# RabbitMQ
#
rabbitmq:
  enabled: true

  replicas: 1
  persistence: {}
  # storageClassName: gp3
  # storage: 10Gi

  resources: {}
  # limits:
  #   cpu: 100m
  #   memory: 128Mi
  # requests:
  #   cpu: 100m
  #   memory: 128Mi

  annotations: {}
  tolerations: []
  affinity: {}

#
# Mailhog
#
mailhog:
  enabled: true

  image:
    repository: docker.io/mailhog/mailhog
    tag: "v1.0.1"
    pullPolicy: IfNotPresent
    pullSecrets: []

  service:
    annotations: {}
    clusterIP: ""
    externalIPs: []
    loadBalancerIP: ""
    loadBalancerSourceRanges: []
    type: ClusterIP
    port:
      http: 8025
      smtp: 1025
    nodePort:
      http: ""
      smtp: ""

  securityContext:
    runAsUser: 1000
    runAsGroup: 1000
    runAsNonRoot: true
    fsGroup: 1000

  containerSecurityContext:
    readOnlyRootFilesystem: true
    privileged: false
    allowPrivilegeEscalation: false
    capabilities:
      drop:
        - ALL

  auth:
    enabled: true
    existingSecret: ""
    fileName: auth.txt
    # User/password is test/test
    fileContents: |
      test:$2a$04$qxRo.ftFoNep7ld/5jfKtuBTnGqff/fZVyj53mUC5sVf9dtDLAi/S

  extraEnv: []

  priorityClassName: ""

  podAnnotations: {}

  podLabels: {}

  resources: {}
  # limits:
  #   cpu: 100m
  #   memory: 128Mi
  # requests:
  #   cpu: 100m
  #   memory: 128Mi

  affinity: {}

  nodeSelector: {}

  tolerations: []

#
# Common Ingress configuration
#
ingress:
  className: ""
  annotations: {}
  # kubernetes.io/ingress.class: nginx-internal
  ## hosts is a list of host names to expose ingress for.
  ## Defaults to <release name>-<namespace>.prv.dev.s8ops.com
  hosts: []
  # - sear-example.local
  tls: []
  # - secretName: sear-example-tls
  #   hosts:
  #     - sear-example.local

#
# Configuration common for all components
#
common:
  # which component templates to use; supported: spring, pythonagent
  type: spring
  # enable component
  enabled: true
  # use database (inject postgres secrets)
  useDb: true
  # configure db name via postgres operator
  dbName: ""
  # std k8s docker image settings
  image:
    repository: ""
    tag: ""
    pullPolicy: IfNotPresent
    pullSecrets: []

  replicaCount: 1

  # override docker entrypoint command
  command: []

  # override docker command arguments
  # values defined in "common", "agentCommon" and specified component are _concatenated_ together
  args: []
  # - --spring.profiles.active=dev

  # inject additional configuration files (eg into /etc/spring/ for type: spring)
  # currently only supported for type: spring
  configFiles: {}
  # application.yml: |
  #   logging:
  #     level:
  #       com.silenteight: DEBUG

  # inject --spring.profiles.include=[] into cmd arguments; only applicable for type: spring
  profiles: []

  # inject --<property>=<value> into cmd arguments; only applicable for type: spring
  properties: {}

  # inject additional yaml entries into default config files:
  # - /etc/spring/kubernetes.yaml for type: spring
  # - /app/config/application.yaml for type: pythonagent
  # (note - /app/config/application.yaml support os environment variables - see "configmap-init-scripts.yaml.tpl")
  additionalConfig: {}

  # inject amqp specific parameters; currently used for type: pythonagent (see "configmap-init-scripts.yaml.tpl")
  amqp: {}

  # inject sentry specific parameters into spring apps (--sentry.dsn, --sentry.environment)
  sentry:
    dsn: ""
    environment: ""

  resources: {}
  # limits:
  #   cpu: 100m
  #   memory: 128Mi
  # requests:
  #   cpu: 100m
  #   memory: 128Mi

  service:
    # Determines how the Service is exposed. Valid options are ExternalName, ClusterIP, NodePort, and LoadBalancer.
    type: ClusterIP
    http:
      port: 8080
    grpc:
      enabled: true
      port: 9090

  containerPorts:
    http:
      port: 8080
    management:
      port: 8081
    grpc:
      enabled: true
      port: 9090

  startupProbe:
    enabled: true
    initialDelaySeconds: 10
    periodSeconds: 10
    timeoutSeconds: 1
    failureThreshold: 30

  livenessProbe:
    enabled: true
    periodSeconds: 10
    timeoutSeconds: 1
    failureThreshold: 3

  readinessProbe:
    enabled: true
    periodSeconds: 10
    timeoutSeconds: 1
    successThreshold: 1
    failureThreshold: 3

  ingress:
    enabled: true

  autoscaling:
    enabled: false
    minReplicas: 1
    maxReplicas: 100
    targetCPUUtilizationPercentage: 80
    # targetMemoryUtilizationPercentage: 80

  nodeSelector: {}
  tolerations: []
  affinity: {}

## override "common" node for agent deployments only
agentsCommon:
  enabled: false
  useDb: false
  image:
    tag: "latest"
  ingress:
    enabled: false

#
# Declare and customize components
#
# Each component can have the following parameters customized:
#
#   dbName  - (String) name of the database. Defaults to the component name.
#   webPath - (String) URL path of this component. Defaults to the component name.
#
# You can also overwrite the `common` configuration, by configuring the following values:
#
#   replicaCount: 1
#   args: []
#   configFiles: {}
#   resources: {}
#   service: {}
#   containerPorts: {}
#   startupProbe: {}
#   livenessProbe: {}
#   readinessProbe: {}
#   ingress: {}
#   autoscaling: {}
#   nodeSelector: {}
#   tolerations: []
#   affinity: {}
#
components:
  hsbc-bridge:
    enabled: false
    image:
      repository: registry.dev.s8ops.com/iris/hsbc-bridge-app

    dbName: "hb"
    webPath: "hsbc-bridge"

  #FAB bridge start
  ftcc:
    enabled: false

    image:
      repository: registry.dev.s8ops.com/ftcc/ftcc-app
      tag: "snapshot"

    dbName: "ftcc"
    webPath: "ftcc"

  dataprep:
    enabled: false

    image:
      repository: registry.dev.s8ops.com/dataprep/dataprep-app
      tag: "snapshot"
  #Fab bridge end

  core-bridge:
    enabled: false

    image:
      repository: registry.dev.s8ops.com/iris/bridge-app
    dbName: cb
    webPath: cb

  payments-bridge:
    enabled: false

    image:
      repository: registry.dev.s8ops.com/iris/sear-payments-bridge-app

    dbName: "pb"
    webPath: "pb"

  universal-data-source:
    image:
      repository: registry.dev.s8ops.com/iris/universal-data-source-app

    dbName: "uds"
    webPath: "uds"

  adjudication-engine:
    image:
      repository: registry.dev.s8ops.com/iris/adjudication-engine-app

    dbName: "ae"
    webPath: "ae"

  governance:
    image:
      repository: registry.dev.s8ops.com/iris/governance-app

    dbName: "gov"

  simulator:
    image:
      repository: registry.dev.s8ops.com/iris/simulator-app

    dbName: "sim"

  webapp:
    image:
      repository: registry.dev.s8ops.com/iris/sens-webapp-backend

  warehouse:
    image:
      repository: registry.dev.s8ops.com/warehouse/warehouse-app
      tag: "latest"

    dbName: "wh"

# FIXME(pputerla) - remark - we're missing list of supported component keys
agents:
  name-agent:
    image:
      repository: registry.dev.s8ops.com/linguistics-agent
  date-agent:
    image:
      repository: registry.dev.s8ops.com/date-agent
  document-comparer-agent:
    command:
      - "/docker-entrypoint.sh"
      - "comparer"
    image:
      repository: registry.dev.s8ops.com/document-agent
  document-recognizer-agent:
    command:
      - "/docker-entrypoint.sh"
      - "recognizer"
    image:
      repository: registry.dev.s8ops.com/document-agent
  document-number-agent:
    command:
      - "/docker-entrypoint.sh"
      - "number"
    image:
      repository: registry.dev.s8ops.com/document-agent
  geo-agent:
    image:
      repository: registry.dev.s8ops.com/geo-agent-default
  learning-engine:
    useDb: true
    dbName: "learningengine"
    image:
      repository: registry.dev.s8ops.com/learning-engine-default
  is-pep-agent:
    image:
      repository: registry.dev.s8ops.com/is-pep-agent-default
  historical-decisions-agent:
    useDb: true
    dbName: "historicaldecisions"
    image:
      repository: registry.dev.s8ops.com/historical-decisions-agent
  allow-list-agent:
    image:
      repository: registry.dev.s8ops.com/allow-list-agent-default
  country-agent:
    image:
      repository: registry.dev.s8ops.com/country-agent
  freetext-agent:
    image:
      repository: registry.dev.s8ops.com/freetext-agent
  gender-agent:
    image:
      repository: registry.dev.s8ops.com/gender-agent
  region-agent:
    image:
      repository: registry.dev.s8ops.com/region-agent
  organization-name-agent:
    type: pythonagent
    image:
      repository: registry.dev.s8ops.com/organization-name-agent
  company-name-surrounding-agent:
    type: pythonagent
    image:
      repository: registry.dev.s8ops.com/company-name-surrounding-agent
    additionalConfig:
      solution_rules:
        - solution: 0
          lower_bound: 0
          upper_bound: 0
        - solution: 1
          lower_bound: 1
          upper_bound: 1
        - solution: 2
          lower_bound: 2
          upper_bound: 2
        - solution: 3
          lower_bound: 3
          upper_bound: 3
        - solution: 4
          lower_bound: 4
          upper_bound: 4
        - solution: 5+
          lower_bound: 5
          upper_bound: 1000000
      default_response: AGENT_ERROR
  hit-type-name-agent:
    type: pythonagent
    image:
      repository: registry.dev.s8ops.com/hit-type-name-agent


#
# Frontend Web Application
#
frontend:
  replicaCount: 1

  image:
    repository: registry.dev.s8ops.com/sep-front-app
    tag: "latest"
    pullPolicy: IfNotPresent
    pullSecrets: []

  service:
    type: ClusterIP
    port: 80

  ingress:
    enabled: true

  resources: {}

  autoscaling:
    enabled: false
    minReplicas: 1
    maxReplicas: 100
    targetCPUUtilizationPercentage: 80
    # targetMemoryUtilizationPercentage: 80

  nodeSelector: {}
  tolerations: []
  affinity: {}

#
# KeyCloak
#
# Configuration of all the values below is required.
#
keycloak:
  internal: true
  realmData:
    users:
      - username: "iris-admin"
        enabled: true
        credentials:
          - type: "password"
            value: "iris-admin"
        clientRoles:
          dev-frontend:
            - QA_ISSUE_MANAGER
            - MODEL_TUNER
            - USER_ADMINISTRATOR
            - QA
            - APPROVER
            - AUDITOR
          account:
            - view-profile
      - username: "qa-user"
        enabled: true
        credentials:
          - type: "password"
            value: "TestPassword123!"
        clientRoles:
          dev-frontend:
            - QA_ISSUE_MANAGER
            - MODEL_TUNER
            - QA
            - APPROVER
            - AUDITOR
          account:
            - view-profile
    clients:
      - client:
          clientId: dev-backend
          secret: 5f8909cc-dd98-11ec-a941-7f28fefdd672
          serviceAccountsEnabled: true
      - client:
          clientId: dev-frontend
          protocol: openid-connect
          clientAuthenticatorType: "client-secret"
          publicClient: true
          standardFlowEnabled: true
          directAccessGrantsEnabled: true
          redirectUris:
            - 'https://{{- .Values.ingress.hosts | default (list (include "sear.defaultHost" $)) | first }}/*'
          defaultClientScopes:
            - web-origins
            - profile
            - roles
            - email
          protocolMappers:
            - config:
                multivalued: "true"
                userinfo.token.claim: "true"
                id.token.claim: "true"
                access.token.claim: "true"
                claim.name: "roles"
                jsonType.label: "String"
              consentRequired: false
              name: "Roles Mapping"
              protocol: "openid-connect"
              protocolMapper: "oidc-usermodel-client-role-mapper"
        roles:
          - name: AUDITOR
          - name: APPROVER
          - name: QA
          - name: USER_ADMINISTRATOR
          - name: MODEL_TUNER
          - name: QA_ISSUE_MANAGER
  authServerUrl: https://auth.dev.s8ops.com/auth
  frontendClientId: dev-frontend
  realm: '{{ include "sear.fullname" . }}'
  jwtIssuerUri: '{{ .Values.keycloak.authServerUrl }}/realms/{{ include "sear.fullname" . }}'
  #TODO(dsniezek): Should be fixed see UserAuthActivityReportGenerator and LastLoginTimeCacheUpdater
  resource: dev-backend
  #TODO(dsniezek):credentials.secret should be stored in a safe manner or injected via operator
  credentials:
    secret: 5f8909cc-dd98-11ec-a941-7f28fefdd672
