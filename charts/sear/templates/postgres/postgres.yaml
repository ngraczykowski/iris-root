apiVersion: acid.zalan.do/v1
kind: postgresql
metadata:
  name: {{ include "sear.fullname" . }}-postgres
  labels:
    app.kubernetes.io/component: database
    {{- include "sear.labels" . | nindent 4 }}
spec:
  teamId: {{ .Release.Name | quote }}

  postgresql:
    version: {{ .Values.database.postgresql.version | quote }}

  numberOfInstances: {{ .Values.database.numberOfInstances }}

  volume:
      size: {{ .Values.database.volume.size | quote }}

  users:
    {{- range $componentName, $component := include "buildComponents" . | mustFromJson }}
    {{- if and $component.enabled $component.useDb }}
    {{ default $componentName $component.dbName }}: []
    {{- end }}
    {{- end }}

  databases:
    {{- range $componentName, $component := include "buildComponents" . | mustFromJson }}
    {{- if and $component.enabled $component.useDb }}
    {{ default $componentName $component.dbName }}: {{ default $componentName $component.dbName }}
    {{- end }}
    {{- end }}
