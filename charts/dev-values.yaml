ingress:
  annotations:
    kubernetes.io/ingress.class: nginx-internal
  hosts:
    - aha-test.dev.s8ops.com

common:
  image:
    pullPolicy: Always

  args:
    - --serp.show-env=true

  resources:
    limits:
      memory: 1Gi
    requests:
      memory: 1Gi
agentsCommon:
  resources:
    limits:
      memory: 1Gi
    requests:
      memory: 512Mi

components:
  payments-bridge:
    enabled: true
    args:
      - --spring.profiles.active=mockaws
    configFiles:
      application.yml: |
        spring:
            security:
              oauth2:
                resourceserver:
                  jwt:
                    issuer-uri: https://auth.silent8.cloud/realms/sierra
                client:
                  registration:
                    callback:
                      client-id: cmapi-dev
                      # Set the client-secret via environment variable SPRING_SECURITY_OAUTH2_CLIENT_REGISTRATION_callback_CLIENT-SECRET
                      #client-secret: <CLIENT SECRET>
                  provider:
                    external:
                      token-uri: https://auth.silent8.cloud/realms/egress-mock/protocol/openid-connect/token
            mail:
              host: localhost
              port: 24170
              username: user
              password: password
              properties:
                mail:
                  smtp:
                    auth: true
                    starttls:
                      enable: true
                  transport:
                    protocol: smtp
        pb:
          daily-reports-remove:
            cron: "*/600 * * * * *"
          alert-message:
            original-message-deleted-after-recommendation: false
          cmapi:
            callback:
              client-registration-id: callback
              enabled: false
              endpoint: "https://cmapi-mock.nomad.silenteight.com/callback-recommendation"
          data-retention:
            alert-data:
              expiration: "365d"
              cron: "*/60 * * * * *"
            personal-information:
              expiration: "1h"
              cron: "* * * * * *"
          email-notification:
            from: "noreply+sierra@silenteight.com"
            to: "proj-svb-ts@silenteight.com"
            cron: "0 0/10 * * * *"
            amount: 10
            cmapiEnabled: false
            learningEnabled: false
          metrics:
            alert-resolution:
              percentiles: [ 0.5, 0.95 ]
          svb-learning:
            discriminator: ""
            aws:
              file-list:
                bucket-name: todo-add-bucket
                prefix: learning
            store:
              skip-deletion: true
            use-new-learning: true

  adjudication-engine:
    args:
      - --spring.profiles.active=rabbitdeclare

  governance:
    args:
      - --spring.profiles.active=linux,governance,database,rabbitmq,messaging,sierra

  simulator:
    args:
      - --spring.profiles.active=linux,simulator,messaging,sierra

  webapp:
    args:
      - --spring.profiles.active=sierra

  warehouse:
    args:
      - --spring.profiles.active=linux,warehouse,messaging,sierra
      # FIXME(ahaczewski): Required to repeat configuration from `keycloak` below due to overwriting
      #  environment variable defined directly in the WebApp container image.
      - --keycloak.frontend-client-id=dev-frontend

    configFiles:
      application.yml: |
        warehouse:
          report:
            default-bucket: todo-add-bucket

        sep:
          filestorage:
            minio:
              privateKey: dummy
              accessKey: dummy
              url: https://todo-add-bucket.s3.eu-central-1.amazonaws.com
              region: eu-central-1

agents:
  name-agent:
    args:
      - --spring.profiles.active=sierra,rabbitmq-declare
      - --linguistics.name.facade.enabled=true
      - --sentry.dsn=https://423d3bd99f14476dbf7354cbd584cc57@o1129201.ingest.sentry.io/6176119
      - --sentry.environment=unknown
    resources:
      limits:
        memory: 2Gi
      requests:
        memory: 1Gi
  date-agent:
    args:
      - --spring.profiles.active=sierra,rabbitmq-declare
      - --dob.agent.facade.enabled=true
  document-comparer-agent:
    args:
      - --spring.profiles.active=sierra,rabbitmq-declare
      - --nationalId.agent.facade.enabled=true
  document-recognizer-agent:
    args:
      - --spring.profiles.active=sierra,rabbitmq-declare
  document-number-agent:
    args:
      - --spring.profiles.active=sierra,rabbitmq-declare
      - --document.agent.facade.enabled=true
  geo-agent:
    args:
      - --spring.profiles.active=sierra,rabbitmq-declare
      - --geo.agent.facade.enabled=true
      - --geotransactions.agent.facade.enabled=true
      - --sentry.dsn=https://057cc65ea9454a98b48877702c1a818f@o1129201.ingest.sentry.io/6176255
      - --sentry.environment=unknown
    resources:
      limits:
        memory: 2Gi
      requests:
        memory: 1Gi
  learning-engine:
    useDb: true
    dbName: "learning-engine"
    args:
      - --spring.profiles.active=sierra,rabbitmq-declare
      - --learning.agent.facade.enabled=true
      - --geotransactions.agent.facade.enabled=true
      - --sentry.dsn=https://057cc65ea9454a98b48877702c1a818f@o1129201.ingest.sentry.io/6176255
      - --sentry.environment=unknown
    resources:
      limits:
        memory: 1Gi
      requests:
        memory: 768Mi
  freetext-agent:
    args:
      - --spring.profiles.active=sierra,rabbitmq-declare
      - --freetext.agent.facade.enabled=true
      - --sentry.dsn=https://3c821f54634b4eae83f786e8ec32d996@o1129201.ingest.sentry.io/6242156
      - --sentry.environment=unknown
    resources:
      limits:
        memory: 2Gi
      requests:
        memory: 1Gi
  gender-agent:
    args:
      - --spring.profiles.active=sierra,rabbitmq-declare
      - --gender.agent.facade.enabled=true
  region-agent:
    args:
      - --spring.profiles.active=sierra,rabbitmq-declare
      - --region.agent.facade.enabled=true
    resources:
      limits:
        memory: 1Gi
      requests:
        memory: 768Mi

frontend:
  resources:
    limits:
      memory: 256Mi
    requests:
      memory: 128Mi

keycloak:
  authServerUrl: https://auth.silenteight.com
  realm: sens-webapp
  frontendClientId: dev-frontend
  jwtIssuerUri: "{{ .Values.keycloak.authServerUrl }}/realms/{{ .Values.keycloak.realm }}"
