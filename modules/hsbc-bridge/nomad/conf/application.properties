server.port={{ env "NOMAD_PORT_http" }}
grpc.port={{ env "NOMAD_PORT_grpc" }}
{{- $nomad_namespace := env "NOMAD_NAMESPACE" -}}
{{- with service (print $nomad_namespace "-hsbc-bridge-db") }}
spring.datasource.url=jdbc:postgresql://{{ (index . 0).Address }}:{{ (index . 0).Port }}/{{ env "NOMAD_NAMESPACE" }}-hsbc-bridge
{{ end -}}
{{- $nomad_namespace := env "NOMAD_NAMESPACE" -}}
{{- with service (print $nomad_namespace "-grpc-governance") }}
grpc.governance.address={{ (index . 0).Address }}:{{ (index . 0).Port }}

silenteight.bridge.solving.model.service.api.grpc-address={{ (index . 0).Address }}:{{ (index . 0).Port }}
{{ end -}}
{{- $nomad_namespace := env "NOMAD_NAMESPACE" -}}
{{- with service (print $nomad_namespace "-grpc-adjudication-engine") }}
grpc.adjudication.address={{ (index . 0).Address }}:{{ (index . 0).Port }}


silenteight.bridge.alert.service.api.grpc-address={{ (index . 0).Address }}:{{ (index . 0).Port }}
silenteight.bridge.analysis.service.api.grpc-address={{ (index . 0).Address }}:{{ (index . 0).Port }}
silenteight.bridge.dataset.service.api.grpc-address={{ (index . 0).Address }}:{{ (index . 0).Port }}

{{ end -}}

#Temporary settings until stable db structure
spring.liquibase.drop-first=true

spring.rabbitmq.addresses={{ range $index, $rabbit := service "amqp.rabbitmq" -}}
{{ if $index }},{{ end -}}
{{ $rabbit.Address }}:{{ $rabbit.Port -}}
{{- end }}
# NOTE(ahaczewski): Intentionally left empty.
spring.rabbitmq.host=
spring.rabbitmq.virtual-host=/{{ env "NOMAD_NAMESPACE" }}
