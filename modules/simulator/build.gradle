plugins {
  id('com.silenteight.iris.build.root-build')

  alias(libs.plugins.freefair.aspectj.weaving) apply false
}

subprojects {Project subproject ->
  pluginManager.withPlugin("java") {
    subproject.pluginManager.apply "io.freefair.aspectj.post-compile-weaving"

    subproject.dependencies {
      implementation libs.jaxb.api
      annotationProcessor libs.spring.boot.configuration.processor
    }

    def ajcArgs = [
        "-Xlintfile", "${rootProject.projectDir}/Xlint.properties".toString(),
    ]

    subproject.tasks.withType(JavaCompile).configureEach {JavaCompile java ->
      java.ajc.options.compilerArgs = ajcArgs
      java.options.fork = true
      java.options.compilerArgs << "-parameters"
    }

    subproject.configurations.implementation {
      exclude group: 'com.silenteight.sep.base', module: '*'
    }
  }
}
