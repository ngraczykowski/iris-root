openapi: 3.0.3
info:
  title: Simulation
  description: Simulation API
  version: 0.1.0
servers:
  - url: '{environment}/rest/simulator/api/v1'
    variables:
      environment:
        enum:
          - http://localhost:24160
          - https://localhost:24111
        default: http://localhost:24160

paths:
  /simulations:
    get:
      description: Returns a list of active simulations (in state NEW, PENDING, RUNNING, DONE, ARCHIVED)
      responses:
        200:
          description: List of active simulations
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/SimulationListDto'

    post:
      description: Create a new simulation
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateSimulationRequest'
      responses:
        201:
          description: Created
  /simulations/{id}:archive:
    post:
      description: Archive simulation
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: 'Simulation UUID'
          example: 'a9b45451-6fde-4832-8dc0-d17b4708d8ca'
      responses:
        200:
          description: Ok

  /simulations/{id}:
    get:
      description: Returns a simulation details
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: 'Simulation UUID'
          example: 'a9b45451-6fde-4832-8dc0-d17b4708d8ca'
      responses:
        200:
          description: Simulation details
          content:
            application/json:
              schema:
                type: object
                $ref: '#/components/schemas/SimulationDto'
  /simulations/{id}/progress:
    get:
      description: Returns a simulation progress
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: 'Simulation UUID'
          example: 'a9b45451-6fde-4832-8dc0-d17b4708d8ca'
      responses:
        200:
          description: Simulation progress
          content:
            application/json:
              schema:
                type: object
                $ref: '#/components/schemas/SimulationProgress'
components:
  schemas:

    SimulationState:
      type: string
      enum: [ PENDING ]

    AnalysisState:
      type: string
      enum: [ NEW, PLANNING, RUNNING, DONE, OUTDATED ]

    CreateSimulationRequest:
      type: object
      required:
        - id
        - simulationName
        - datasetIds
        - modelName
      properties:
        id:
          type: string
        simulationName:
          type: string
        description:
          type: string
        datasetIds:
          type: array
          items:
            properties:
              datasetId:
                type: string
        modelName:
          type: string
          description: Model resource name
      example:
        id: 'a9b45451-6fde-4832-8dc0-d17b4708d8ca'
        simulationName: 'New simulation'
        description: 'Simulation description'
        datasetIds: ['b4708d8c-4832-6fde-8dc0-d17b4708d8ca']
        modelName: 'models/d17b4708-6fde-8dc0-4832-d17b4708d8ca'

    SimulationListDto:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        simulationName:
          type: string
        state:
          type: object
          $ref: '#/components/schemas/SimulationState'
        datasets:
          type: array
          items:
            properties:
              datasetName:
                type: string
        model:
          type: string
          description: Model resource name
        createdAt:
          type: string
        createdBy:
          type: string
        updatedAt:
          type: string
      example:
        id: 'a9b45451-6fde-4832-8dc0-d17b4708d8ca'
        name: 'simulations/a9b45451-6fde-4832-8dc0-d17b4708d8ca'
        simulationName: 'Simulation name'
        description: 'Simulation description'
        datasets: ['datasets/b4708d8c-4832-6fde-8dc0-d17b4708d8ca']
        model: 'models/d17b4708-6fde-8dc0-4832-d17b4708d8ca'
        state: 'PENDING'
        createdAt: '2004-02-12T15:19:21Z'
        createdBy: 'UserName'
        updatedAt: '2004-02-15T15:19:21Z'

    SimulationDto:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        simulationName:
          type: string
        state:
          type: object
          $ref: '#/components/schemas/SimulationState'
        datasets:
          type: array
          items:
            properties:
              datasetName:
                type: string
        model:
          type: string
          description: Model resource name
        analysis:
          type: string
          description: Analysis resource name
        startedAt:
          type: string
        finishedAt:
          type: string
        updatedAt:
          type: string
        createdAt:
          type: string
        createdBy:
          type: string
      example:
        id: 'a9b45451-6fde-4832-8dc0-d17b4708d8ca'
        name: 'simulations/a9b45451-6fde-4832-8dc0-d17b4708d8ca'
        simulationName: 'Simulation name'
        description: 'Simulation description'
        datasets: ['datasets/b4708d8c-4832-6fde-8dc0-d17b4708d8ca']
        model: 'models/d17b4708-6fde-8dc0-4832-d17b4708d8ca'
        analysis: 'analysis/b4708d8c-4832-8dc0-4832-d17b4708d8ca'
        state: 'PENDING'
        createdAt: '2004-02-12T15:09:21Z'
        startedAt: '2004-02-12T16:19:21Z'
        finishedAt: '2004-02-13T09:19:21Z'
        updatedAt: '2004-02-13T09:19:21Z'
        createdBy: 'UserName'

    SimulationProgress:
      type: object
      required:
        - allAlerts
        - solvedAlerts
        - indexedAlerts
      properties:
        allAlerts:
          type: integer
        solvedAlerts:
          type: integer
        indexedAlerts:
          type: integer
      example:
        allAlerts: 200
        solvedAlerts: 200
        indexedAlerts: 200
