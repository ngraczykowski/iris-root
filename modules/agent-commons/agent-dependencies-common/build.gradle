plugins {
  id "idea"
  id "java-platform"
  id "maven-publish"
  id 'com.github.ben-manes.versions' version "0.36.0"
}

javaPlatform {
  allowDependencies()
}

// NOTE: it stems from com.silenteight.sep:sep-dependencies:2.2.0
ext {
  // Silent Eight
  s8consulDiscoveryVersion = "2.2.0"
  s8consulGrpcRegistrationVersion = "1.0.0"
  s8commonsVersion = "2.0.0"

  // Keep sorted alphabetically.
  antlr4Version = "4.9.2"
  apacheCommonsCsvVersion = "1.8"
  apacheCommonsCollectionsVersion = "4.4"
  aspectjVersion = "1.9.6"
  bouncyCastleExtVersion = "1.69"
  bouncyCastleVersion = "1.69"
  byteBuddyVersion = "1.11.1"
  caffeineVersion = "3.0.2"
  commonsIoVersion = "2.6"
  elasticLoggingVersion = "1.0.1"
  groovyAllVersion = "3.0.8"
  guavaVersion = "30.1.1-jre"
  hibernateVersion = "5.4.32.Final"
  jakartaElVersion = "3.0.3"
  jakartaMailVersion = "1.6.5"
  netDevhGrpcSpringBootStarterVersion = "2.12.0.RELEASE"
  queryDslVersion = "4.4.0"
  restAssuredVersion = "4.4.0"
}

dependencies {
  // NOTE(ahaczewski): Do not change the order of platforms!
  api platform("org.tribuo:tribuo-all:4.1.0")
  api platform("org.junit:junit-bom:5.7.2")
  api platform("org.testcontainers:testcontainers-bom:1.15.3")
  api platform("jakarta.platform:jakarta.jakartaee-bom:8.0.0")
  api platform("io.projectreactor:reactor-bom:2020.0.7")
  api platform("io.grpc:grpc-bom:1.38.0")
  api platform("io.zipkin.brave:brave-bom:5.13.3")
  api platform("io.micrometer:micrometer-bom:1.6.7")
  api platform("com.google.protobuf:protobuf-bom:3.17.3")
  api platform("org.spockframework:spock-bom:2.0-groovy-3.0")
  api platform("org.springframework.boot:spring-boot-dependencies:2.4.6")
  api platform("org.springframework.cloud:spring-cloud-dependencies:2020.0.3")

  // Keep each group sorted alphabetically.
  constraints {
    // Silent Eight
    api "com.silenteight.commons:silenteight-commons-core:$s8commonsVersion"
    api "com.silenteight.commons:consul-grpc-registration:$s8consulGrpcRegistrationVersion"
    api "com.silenteight.spring.cloud.consul.discovery:silenteight-spring-cloud-consul-discovery:$s8consulDiscoveryVersion"

    // Miscellaneous Dependencies
    api "co.elastic.logging:logback-ecs-encoder:$elasticLoggingVersion"
    api "co.elastic.logging:ecs-logging-core:$elasticLoggingVersion"
    api "com.esotericsoftware:kryo-shaded:4.0.2"
    api "com.github.ben-manes.caffeine:caffeine:$caffeineVersion"
    api "com.github.ben-manes.caffeine:jcache:$caffeineVersion"
    api "com.google.code.findbugs:jsr305:3.0.2"
    api "com.google.guava:guava:$guavaVersion"
    api "com.oracle:ojdbc8:12.2.0.1"
    api "com.orbitz.consul:consul-client:1.5.2"
    api "com.querydsl:querydsl-apt:$queryDslVersion:jpa" //TODO do we need both? (MI6-638)
    api "com.querydsl:querydsl-jpa:$queryDslVersion"
    api "com.salesforce.servicelibs:reactor-grpc-stub:1.0.1"
    api "com.sun.mail:jakarta.mail:$jakartaMailVersion"
    api "com.thoughtworks.paranamer:paranamer:2.8"
    api "com.zaxxer:HikariCP:4.0.3"
    api "commons-io:commons-io:$commonsIoVersion"
    api "io.github.classgraph:classgraph:4.8.108"
    api "io.jsonwebtoken:jjwt:0.9.1"
    api "jakarta.activation:jakarta.activation-api:1.2.2"
    api "jakarta.annotation:jakarta.annotation-api:1.3.5"
    api "jakarta.batch:jakarta.batch-api:1.0.2"
    api "jakarta.el:jakarta.el-api:$jakartaElVersion"
    api "jakarta.inject:jakarta.inject:1.0.1"
    api "jakarta.mail:jakarta.mail-api:$jakartaMailVersion"
    api "jakarta.persistence:jakarta.persistence-api:2.2.3"
    api "jakarta.servlet:jakarta.servlet-api:4.0.3"
    api "jakarta.transaction:jakarta.transaction-api:1.3.3"
    api "jakarta.validation:jakarta.validation-api:2.0.2"
    api "jakarta.xml.bind:jakarta.xml.bind-api:2.3.3"
    api "javax.cache:cache-api:1.1.1"
    api "net.bytebuddy:byte-buddy-agent:$byteBuddyVersion"
    api "net.bytebuddy:byte-buddy:$byteBuddyVersion"
    api "net.devh:grpc-client-spring-boot-starter:$netDevhGrpcSpringBootStarterVersion"
    api "net.devh:grpc-server-spring-boot-starter:$netDevhGrpcSpringBootStarterVersion"
    api "net.devh:grpc-spring-boot-starter:$netDevhGrpcSpringBootStarterVersion"
    api "net.logstash.logback:logstash-logback-encoder:6.6"
    api "org.antlr:antlr4-runtime:$antlr4Version"
    api "org.antlr:antlr4:$antlr4Version"
    api "org.apache.commons:commons-collections4:$apacheCommonsCollectionsVersion"
    api "org.apache.commons:commons-math3:3.6.1"
    api "org.apache.commons:commons-text:1.9"
    api "org.apache.commons:commons-csv:$apacheCommonsCsvVersion"
    api "org.aspectj:aspectjrt:$aspectjVersion"
    api "org.aspectj:aspectjtools:$aspectjVersion"
    api "org.aspectj:aspectjweaver:$aspectjVersion"
    api "org.assertj:assertj-core:3.19.0"
    api "org.awaitility:awaitility:4.1.0"
    api "org.bouncycastle:bcmail-jdk15on:$bouncyCastleVersion"
    api "org.bouncycastle:bcpg-jdk15on:$bouncyCastleVersion"
    api "org.bouncycastle:bcpkix-jdk15on:$bouncyCastleVersion"
    api "org.bouncycastle:bcprov-ext-jdk15on:$bouncyCastleExtVersion"
    api "org.bouncycastle:bcprov-jdk15on:$bouncyCastleVersion"
    api "org.freemarker:freemarker:2.3.31"
    api "org.glassfish:jakarta.el:$jakartaElVersion"
    api "org.hibernate.validator:hibernate-validator:6.1.7.Final"
    api "org.hibernate:hibernate-core:$hibernateVersion"
    api "org.hibernate:hibernate-envers:$hibernateVersion"
    api "org.hibernate:hibernate-jcache:$hibernateVersion"
    api "org.jetbrains:annotations:21.0.1"
    api "org.liquibase:liquibase-core:4.3.5"
    api "org.lz4:lz4-java:1.7.1"
    api "org.postgresql:postgresql:42.2.20"
    api "org.projectlombok:lombok:1.18.20"
    api "org.slf4j:slf4j-api:1.7.30"
    api "com.univocity:univocity-parsers:2.9.0"

    // Testing
    api "com.jayway.jsonpath:json-path:2.6.0"
    api "com.revinate:assertj-json:1.2.0"
    api "io.rest-assured:rest-assured:$restAssuredVersion"
    api "io.rest-assured:spring-mock-mvc:$restAssuredVersion"
    api "org.codehaus.groovy:groovy-all:$groovyAllVersion"
    api "org.hamcrest:hamcrest:2.2"
  }
}

publishing {
  publications {
    sepDependencies(MavenPublication) {
      from components.javaPlatform
    }
  }
}

tasks.named("dependencyUpdates").configure {
  checkConstraints = true
}
