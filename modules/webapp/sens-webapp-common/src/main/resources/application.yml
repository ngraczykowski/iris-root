####################################################################################################
# Defaults (overridden by environment variables or arguments)
####################################################################################################

sens.webapp.db.host: localhost
sens.webapp:.db.port: 24011
sens.webapp:.db.schema: public
sens.webapp:.db.name: senswebapp
sens.webapp:.db.user: senswebapp
sens.webapp:.db.password: senswebapp
sens.webapp:.db.url: jdbc:postgresql://${sens.webapp.db.host}:${sens.webapp.db.port}/${sens.webapp.db.name}?currentSchema=${sens.webapp.db.schema}

sens.webapp:.db.connections.min: 1
sens.webapp:.db.connections.max: 10

####################################################################################################
# CONFIGURATION
####################################################################################################

spring:
  datasource:
    # Postgres database
    type: com.zaxxer.hikari.HikariDataSource
    url: ${sens.webapp.db.url}
    username: ${sens.webapp.db.user}
    password: ${sens.webapp.db.password}
    initialization-mode: never

    # Hikari pool configuration
    hikari:
      pool-name: Database-Pool
      minimum-idle: ${sens.webapp.db.connections.min}
      maximum-pool-size: ${sens.webapp.db.connections.max}
      auto-commit: false
      schema: ${sens.webapp.db.schema}
      isolate-internal-queries: true
      connection-init-sql: SELECT 1
      data-source-properties:
        ApplicationName: SENS WebApp (${spring.application.name})

  # Database migrations
  liquibase:
    change-log: classpath:db/changelog/db.changelog-master.xml
    default-schema: ${sens.webapp.db.schema}
    contexts: default

  # Spring Data JPA
  jpa:
    database-platform: com.silenteight.sens.webapp.common.support.hibernate.FixedPostgreSql95Dialect
    database: POSTGRESQL
    show-sql: false
    open-in-view: false

    hibernate:
      ddl-auto: none
      use-new-id-generator-mappings: true

    properties:
      hibernate.cache.use_query_cache: false
      hibernate.connection.provider_disables_autocommit: true
      hibernate.generate_statistics: false
      hibernate.jdbc.lob.non_contextual_creation: true
      hibernate.jdbc.time_zone: UTC
      hibernate.temp.use_jdbc_metadata_defaults: false
      org.hibernate.envers.audit_table_suffix: _audit
      org.hibernate.envers.store_data_at_delete: true
