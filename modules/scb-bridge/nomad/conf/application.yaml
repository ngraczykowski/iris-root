server:
  port: {{ env "NOMAD_PORT_http" }}

grpc:
  server:
    port: {{ env "NOMAD_PORT_grpc" }}
  client:
    recommendation.address: discovery:///{{ env "NOMAD_NAMESPACE" }}-grpc-core-bridge
    registration.address: discovery:///{{ env "NOMAD_NAMESPACE" }}-grpc-core-bridge
    universal-data-source.address: discovery:///{{ env "NOMAD_NAMESPACE" }}-grpc-universal-data-source

spring:
  {{ $nomad_namespace := env "NOMAD_NAMESPACE" }}
    {{ with service (print $nomad_namespace "-scb-bridge-db") }}
    datasource.url: jdbc:postgresql://{{ (index . 0).Address }}:{{ (index . 0).Port }}/{{ env "NOMAD_NAMESPACE" }}-scb-bridge
    {{ end -}}
    rabbitmq:
      addresses: {{ range $index, $rabbit := service "amqp.rabbitmq" -}}
        {{ if $index }},{{ end -}}
        {{ $rabbit.Address }}:{{ $rabbit.Port -}}
    {{- end }}
    # NOTE(ahaczewski): Intentionally left empty.
    host:
    virtual-host: /{{ env "NOMAD_NAMESPACE" }}

    #-------------------------------------------------------------------------------------------------
    # Consul Service Discovery
    #-------------------------------------------------------------------------------------------------
    cloud:
      consul:
        enabled: true
        host: localhost
        port: 8500
        scheme: http
        discovery:
          enabled: true
          register: false
          register-health-check: false
          catalog-services-watch:
            enabled: true
        service-registry:
          auto-registration:
            enabled: false


management:
  endpoint:
    health.show-details: always
  endpoints:
    web:
      base-path: /management
      exposure:
        include: ["health", "info", "liquibase", "metrics", "prometheus", "loggers"]

### REGISTRATION
registration:
  analysis:
    mock-recommendations-generation: false

### SENTRY
sentry:
  dsn: https://5991989c7325495fbdeff0bd32ddbb1d@o1129201.ingest.sentry.io/6204134
  environment: unknown
  tracesSampleRate: 0