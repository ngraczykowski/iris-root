server:
  port: {{ env "NOMAD_PORT_http" }}

spring:
  rabbitmq:
    addresses: {{ range $index, $rabbit := service "amqp.rabbitmq" -}}
      {{ if $index }},{{ end -}}
      {{ $rabbit.Address }}:{{ $rabbit.Port -}}
{{- end }}
    # NOTE(ahaczewski): Intentionally left empty.
    host:
    virtual-host: /{{ env "NOMAD_NAMESPACE" }}
  elasticsearch:
    rest:
      uris: {{ range $index, $es := service "http.elasticsearch" -}}
        {{ if $index }},{{ end -}}
        {{ $es.Address }}:{{ $es.Port -}}
{{- end }}
  cloud:
    consul:
      enabled: true
      host: localhost
      port: 8500
      scheme: http
      discovery:
        enabled: true
        register: false
        register-health-check: false
        catalog-services-watch:
          enabled: true
      service-registry:
        auto-registration:
          enabled: false

warehouse:
  alert-mapping:
    country-source-key: 1.CustomerEntities.edqLoBCountryCode
    ignored-keys:
      - "[02-9]{1,}\\.CustomerEntities\\..*"
      - "\\d{1,}\\.DN_CASECOMMENT\\..*"
      - "\\d{1,}\\.DN_CASEHISTORY\\..*"
      - "\\d{1,}\\.Relationships\\..*"
      - "\\d{1,}\\.WorldCheckEntities\\..*"
      - "DN_CASE\\..*"
  messaging:
    integration:
      production-indexing-inbound:
        queue-name: wh.index-request.production
      production-indexed-outbound:
        exchange-name: wh.event
        routing-key: event.index-response.production
      simulation-indexing-inbound:
        queue-name: wh.index-request.simulation
      simulation-indexed-outbound:
        exchange-name: wh.event
        routing-key: event.index-response.simulation
  opendistro:
    max-object-count: 10000
  environment:
    prefix: dev
  db:
    name: {{ env "NOMAD_NAMESPACE" }}-warehouse
{{- $nomad_namespace := env "NOMAD_NAMESPACE" -}}
{{- with service (print $nomad_namespace "-warehouse-db") }}
    host: {{ (index . 0).Address }}
    port: {{ (index . 0).Port }}
  {{ end -}}
  minio:
    url: https://minio.silenteight.com
  kibana:
    url: https://kibana.silenteight.com

keycloak:
  client-id: {{ env "NOMAD_NAMESPACE" }}-frontend
  adapter:
    auth-server-url: https://auth.silenteight.com
    realm: sens-webapp
    public-client: false
    confidential-port: 0
    principal-attribute: preferred_username
    ssl-required: external

grpc:
  logging:
    enabled: true
  server:
    port: {{ env "NOMAD_PORT_grpc" }}

warehouse.report.rbs:
  columns:
    - name: alert_fvSignature
      label: fv_signature
    - name: alert_policyId
      label: policy_id
    - name: alert_stepId
      label: step_id
    - name: alert_recommendation
      label: recommended action
    - name: alert_extendedAttribute5
      label: risk_type
    - name: alert_dateOfBirthFeatureSolution
      label: date_of_birth
    - name: alert_genderFeatureSolution
      label: gender
    - name: alert_incorporationCountryFeatureSolution
      label: incorporation_country
    - name: alert_nameFeatureSolution
      label: name
    - name: alert_nationalIdDocumentFeatureSolution
      label: national_id_document
    - name: alert_nationalityCountryFeatureSolution
      label: national_country
    - name: alert_otherCountryFeatureSolution
      label: other_country
    - name: alert_otherDocumentFeatureSolution
      label: other_document
    - name: alert_passportNumberDocumentFeatureSolution
      label: passport_number_document
    - name: alert_registrationCountryFeatureSolution
      label: registration_country
    - name: alert_residencyCountryFeatureSolution
      label: residency_country
  grouping-columns:
    - name: alert_qa.level-0.state
      label: qa_decision
      grouping-values: [PASSED, FAILED]
      add-counter: true
    - name: alert_DN_CASE.currentState
      label: analysis_decision
      grouping-values: Level 1 Review, Level 2 Review
      add-counter: false
  date-field-name: index_timestamp

warehouse.report.billing:
  columns:
    - name: alert_recommendationYear
      label: YEAR
    - name: alert_recommendationMonth
      label: MONTH
  grouping-columns:
    - name: alert_recommendation
      label: COUNT_SOLVED
      grouping-values: [AAA False Positive, Level 1 Review, Level 2 Review, Level 3 Review]
      counterSuffix: ALL
  date-field-name: index_timestamp
