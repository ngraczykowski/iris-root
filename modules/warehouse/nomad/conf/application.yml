server:
  port: {{ env "NOMAD_PORT_http" }}

spring:
  rabbitmq:
    addresses: {{ range $index, $rabbit := service "amqp.rabbitmq" -}}
      {{ if $index }},{{ end -}}
      {{ $rabbit.Address }}:{{ $rabbit.Port -}}
{{- end }}
    # NOTE(ahaczewski): Intentionally left empty.
    host:
    virtual-host: /{{ env "NOMAD_NAMESPACE" }}
  elasticsearch:
    rest:
      uris: {{ range $index, $es := service "http.elasticsearch" -}}
        {{ if $index }},{{ end -}}
        {{ $es.Address }}:{{ $es.Port -}}
{{- end }}
  cloud:
    consul:
      enabled: true
      host: localhost
      port: 8500
      scheme: http
      discovery:
        enabled: true
        register: false
        register-health-check: false
        catalog-services-watch:
          enabled: true
      service-registry:
        auto-registration:
          enabled: false

warehouse:
  alert-mapping:
    country-source-key: s8_lobCountryCode
    ignored-keys:
      - "[02-9]{1,}\\.CustomerEntities\\..*"
      - "\\d{1,}\\.PrivateListEntities\\..*"
      - "\\d{1,}\\.CustomerIndividuals\\..*"
      - "\\d{1,}\\.DN_CASECOMMENT\\..*"
      - "\\d{1,}\\.DN_CASEHISTORY\\..*"
      - "\\d{1,}\\.Relationships\\..*"
      - "\\d{1,}\\.WorldCheckEntities\\..*"
      - "\\d{1,}\\.WorldCheckIndividuals\\..*"
  messaging:
    integration:
      backup-indexing-inbound:
        queue-name: wh.index-request.backup
      production-indexing-inbound:
        queue-name: wh.index-request.production
      production-indexed-outbound:
        exchange-name: wh.event
        routing-key: event.index-response.production
      simulation-indexing-inbound:
        queue-name: wh.index-request.simulation
      simulation-indexed-outbound:
        exchange-name: wh.event
        routing-key: event.index-response.simulation
  opendistro:
    max-object-count: 10000
  environment:
    prefix: dev
  db:
    name: {{ env "NOMAD_NAMESPACE" }}-warehouse
{{- $nomad_namespace := env "NOMAD_NAMESPACE" -}}
{{- with service (print $nomad_namespace "-warehouse-db") }}
    host: {{ (index . 0).Address }}
    port: {{ (index . 0).Port }}
  {{ end -}}
  minio:
    url: https://minio.silenteight.com
  kibana:
    url: https://kibana.silenteight.com

keycloak:
  client-id: {{ env "NOMAD_NAMESPACE" }}-frontend
  adapter:
    auth-server-url: https://auth.silenteight.com
    realm: sens-webapp
    public-client: false
    confidential-port: 0
    principal-attribute: preferred_username
    ssl-required: external

grpc:
  logging:
    enabled: true
  server:
    port: {{ env "NOMAD_PORT_grpc" }}

warehouse.report.rbs:
  production:
    date-field-name: alert_recommendationDate
    columns:
      - name: alert_fvSignature
        label: fv_signature
      - name: alert_policyId
        label: policy_id
      - name: alert_policy_title
        label: policy_title
      - name: alert_stepId
        label: step_id
      - name: alert_step_title
        label: step_title
      - name: alert_s8_recommendation
        label: alert_recommendation
      - name: alert_extendedAttribute5
        label: risk_type
      - name: alert_features/commonAp:solution
        label: common_ap
      - name: alert_features/commonMp:solution
        label: common_mp
      - name: alert_features/commonNames:solution
        label: common_names
      - name: alert_features/dateOfBirth:solution
        label: date_of_birth
      - name: alert_features/gender:solution
        label: gender
      - name: alert_features/geoPlaceOfBirth:solution
        label: geo_place_of_birth
      - name: alert_features/geoResidencies:solution
        label: geo_residencies
      - name: alert_features/incorporationCountry:solution
        label: incorporation_country
      - name: alert_features/invalidAlert:solution
        label: invalid_alert
      - name: alert_features/isApTpMarked:solution
        label: is_ap_tp_marked
      - name: alert_features/isCaseTpMarked:solution
        label: is_case_tp_marked
      - name: alert_features/isPep:solution
        label: is_pep
      - name: alert_features/isTpMarked:solution
        label: is_tp_marked
      - name: alert_features/logicalDiscountingDob:solution
        label: logical_discounting_dob
      - name: alert_features/name:solution
        label: name
      - name: alert_features/nationalIdDocument:solution
        label: national_id_document
      - name: alert_features/nationalityCountry:solution
        label: nationality_country
      - name: alert_features/otherCountry:solution
        label: other_country
      - name: alert_features/otherDocument:solution
        label: other_document
      - name: alert_features/passportNumberDocument:solution
        label: passport_number_document
      - name: alert_features/registrationCountry:solution
        label: registration_country
      - name: alert_features/residencyCountry:solution
        label: residency_country

    grouping-columns:
      - name: alert_qa.level-0.state
        label: QA_decision
        grouping-values:
          - value: PASS
            label: qa_decision_pass
          - value: FAILED
            label: qa_decision_failed
      - name: alert_analysis_decision
        label: analyst_decision
        grouping-values:
          - value: FP
            label: analyst_decision_false_positive
          - value: PTP
            label: analyst_decision_potential_true_positive

  simulation:
    date-field-name: index_timestamp
    columns:
      - name: alert_match_reason:feature_vector_signature
        label: fv_signature
      - name: alert_match_reason:policy
        label: policy_id
      - name: alert_match_reason:policy_title
        label: policy_title
      - name: alert_match_reason:step
        label: step_id
      - name: alert_match_reason:step_title
        label: step_title
      - name: alert_recommendation_recommended_action
        label: alert_recommendation
      - name: alert_categories/hitType:value
        label: risk_type
      - name: alert_features/commonAp:solution
        label: common_ap
      - name: alert_features/commonMp:solution
        label: common_mp
      - name: alert_features/commonNames:solution
        label: common_names
      - name: alert_features/dateOfBirth:solution
        label: date_of_birth
      - name: alert_features/gender:solution
        label: gender
      - name: alert_features/geoPlaceOfBirth:solution
        label: geo_place_of_birth
      - name: alert_features/geoResidencies:solution
        label: geo_residencies
      - name: alert_features/incorporationCountry:solution
        label: incorporation_country
      - name: alert_features/invalidAlert:solution
        label: invalid_alert
      - name: alert_features/isApTpMarked:solution
        label: is_ap_tp_marked
      - name: alert_features/isCaseTpMarked:solution
        label: is_case_tp_marked
      - name: alert_features/isPep:solution
        label: is_pep
      - name: alert_features/isTpMarked:solution
        label: is_tp_marked
      - name: alert_features/logicalDiscountingDob:solution
        label: logical_discounting_dob
      - name: alert_features/name:solution
        label: name
      - name: alert_features/nationalIdDocument:solution
        label: national_id_document
      - name: alert_features/nationalityCountry:solution
        label: nationality_country
      - name: alert_features/otherCountry:solution
        label: other_country
      - name: alert_features/otherDocument:solution
        label: other_document
      - name: alert_features/passportNumberDocument:solution
        label: passport_number_document
      - name: alert_features/registrationCountry:solution
        label: registration_country
      - name: alert_features/residencyCountry:solution
        label: residency_country

    grouping-columns:
      - name: alert_qa.level-0.state
        label: QA_decision
        grouping-values:
          - value: PASS
            label: qa_decision_pass
          - value: FAILED
            label: qa_decision_failed
      - name: alert_analyst_decision
        label: analyst_decision
        grouping-values:
          - value: FP
            label: analyst_decision_false_positive
          - value: PTP
            label: analyst_decision_potential_true_positive

warehouse.report.billing:
  year-field-name: alert_recommendationYear
  month-field-name: alert_recommendationMonth
  date-field-name: alert_recommendationDate
  year-month-label: date
  transpose-column:
    name: alert_s8_recommendation
    grouping-values:
      - name: ACTION_FALSE_POSITIVE
        label: count_solved_FP
      - name: ACTION_POTENTIAL_TRUE_POSITIVE
        label: count_solved_PTP
      - name: ACTION_INVESTIGATE
        label: count_solved_MI
    counter-label: count_alerts_received
    significant-values: [ ACTION_FALSE_POSITIVE, ACTION_POTENTIAL_TRUE_POSITIVE]
    significant-summation-label: count_alerts_solved

warehouse.report.metrics:
  production:
    date-field:
      name: index_timestamp
      label: Date
      source-pattern: yyyy-MM-dd HH:mm:ss.SSS
      target-pattern: yyyy-MM
    risk-type:
      name: alert_extendedAttribute5
      label: Risk Type
    hit-type:
      name: alert_categories/hitType:value
      label: Hit Type
    country:
      name: s8_country
      label: Country
    recommendation-field:
      name: alert_s8_recommendation
      positive-value: ACTION_POTENTIAL_TRUE_POSITIVE
      negative-value: ACTION_FALSE_POSITIVE
    analyst-decision-field:
      name: alert_analyst_decision
      positive-value: analyst_decision_true_positive
      negative-value: analyst_decision_false_positive
    qa-decision-field:
      name: alert_qa.level-0.state
      positive-value: qa_decision_PASSED
      negative-value: qa_decision_FAILED
  simulation:
    date-field:
      name: index_timestamp
      label: Date
      source-pattern: yyyy-MM-dd HH:mm:ss.SSS
      target-pattern: yyyy-MM
    risk-type:
      name: alert_extendedAttribute5
      label: Risk Type
    hit-type:
      name: alert_categories/hitType:value
      label: Hit Type
    country:
      name: s8_country
      label: Country
    recommendation-field:
      name: alert_recommendation_recommended_action
      positive-value: ACTION_POTENTIAL_TRUE_POSITIVE
      negative-value: ACTION_FALSE_POSITIVE
    analyst-decision-field:
      name: alert_analyst_decision
      positive-value: analyst_decision_true_positive
      negative-value: analyst_decision_false_positive
    qa-decision-field:
      name: alert_qa.level-0.state
      positive-value: qa_decision_PASSED
      negative-value: qa_decision_FAILED

warehouse.report.statistics:
  date-field-name: index_timestamp
  ai-decision:
    field: alert_recommendation_recommended_action
    significant-values: [ACTION_FALSE_POSITIVE, ACTION_POTENTIAL_TRUE_POSITIVE]
    false-positive-value: ACTION_FALSE_POSITIVE
  analyst-decision:
    field: alert_DN_CASE.currentState
    false-positive-value: Level 1 Review
