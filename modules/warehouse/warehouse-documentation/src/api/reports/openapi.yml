openapi: 3.0.3
info:
  title: Report
  description: Report API
  version: 0.1.0
servers:
  - url: '{environment}/rest/warehouse/api/v1'
    variables:
      environment:
        enum:
          - http://localhost:24291
          - https://localhost:24111
        default: http://localhost:24291

paths:
  /analysis/{analysisId}/tenant:
    get:
      description: Returns a name of the tenat in the Kibana.
      parameters:
        - in: path
          name: analysisId
          required: true
          schema:
            type: string
          description: 'Analysis Id'
          example: 'a9b45451-6fde-4832-8dc0-d17b4708d8ca'
      responses:
        200:
          description: Returns a name of the tenat in the Kibana.
          content:
            application/json:
              schema:
                type: array
                items:
                  type: string
              example:
                "sim_simulation_49"

  /analysis/{analysisId}/definitions:
    get:
      description: Returns a list of reports for specific analysis
      parameters:
      - in: path
        name: analysisId
        required: true
        schema:
          type: string
        allowEmptyValue: false
        description: 'Analysis Id'
        example: 'a9b45451-6fde-4832-8dc0-d17b4708d8ca'
      responses:
        200:
          description: Returns a list of reports
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Report'
              example:
                - id: 'FlpJp3kBtnbt7Zpy1zHr'
                  name: '/analysis/a9b45451-6fde-4832-8dc0-d17b4708d8ca/definitions/reports/FlpJp3kBtnbt7Zpy1zHr'
                  title: 'AI Reasoning'
                  description: 'Ai Reasoning report'
                - id: 'lVrjnHkBtnbt7ZpytDA6'
                  name: '/analysis/a9b45451-6fde-4832-8dc0-d17b4708d8ca/definitions/reports/lVrjnHkBtnbt7ZpytDA6'
                  title: 'Accuracy'
                  description: 'Accuracy report'

  /analysis/{analysisId}/definitions/{id}/reports:
    post:
      description: Generate report instance.
      parameters:
        - in: path
          name: analysisId
          required: true
          schema:
            type: string
          allowEmptyValue: false
          description: 'Analysis Id'
          example: 'a9b45451-6fde-4832-8dc0-d17b4708d8ca'
        - name: id
          in: path
          description: Report definition Id.
          required: true
          schema:
            type: string
          style: simple
          explode: false
          example: FlpJp3kBtnbt7Zpy1zHr
      responses:
        303:
          description: Redirect to the report instance.
          headers:
            Location:
              description: The report will be available over an URL address /analysis/a9b45451-6fde-4832-8dc0-d17b4708d8ca/definitions/FlpJp3kBtnbt7Zpy1zHr/reports/1622009778938
              schema:
                type: string
                example: reports/1622009778938

  /analysis/{analysisId}/definitions/{id}/reports/{timestamp}:
    get:
      description: Returns simulation report
      parameters:
        - in: path
          name: analysisId
          required: true
          schema:
            type: string
          allowEmptyValue: false
          description: 'Analysis Id'
          example: 'a9b45451-6fde-4832-8dc0-d17b4708d8ca'
        - name: id
          in: path
          description: Report definition Id.
          required: true
          schema:
            type: string
          style: simple
          explode: false
          example: FlpJp3kBtnbt7Zpy1zHr
        - in: path
          name: timestamp
          description: Report instance timestamp. This value allows downloading a report in a specific time range (e.g. 1h since generating).
          required: true
          schema:
            type: string
          example: 1622009778938
      responses:
        102:
          description: Processing. The report is still generating. Try again later.
        200:
          description: Returns a report.
          content:
            text/csv:
              schema:
                format: binary
                type: string

  /analysis/production:synchronizePeriodic:
    post:
      description: Synchronize production reports.
      parameters:
        - in: path
          name: analysisId
          required: true
          schema:
            type: string
          description: 'Analysis Id'
          example: 'a9b45451-6fde-4832-8dc0-d17b4708d8ca'
      responses:
        201:
          description: OK

  /analysis/production/definitions/{type}:
    get:
      description: Return a list of reports definitions based on production data.
      parameters:
        - in: path
          name: type
          required: true
          schema:
            $ref: '#/components/schemas/ReportType'
          style: simple
          explode: false
          description: Report type
          example: AI_REASONING
      responses:
        200:
          description: List of reports available to generate.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Report'
              example:
                - id: 'a9b45451d17b4708d8ca'
                  name: '/analysis/production/definitions/AI_REASONING/reports/a9b45451d17b4708d8ca'
                  title: 'AI Reasoning'
                  description: 'Last month'
                  reportType: 'AI_REASONING'
                - id: 'b9b45451d17b4708d8ch'
                  name: '/analysis/production/definitions/AI_REASONING/reports/AI_REASONING/b9b45451d17b4708d8ch'
                  title: 'AI Reasoning'
                  description: 'Last 3 months'
                  reportType: 'AI_REASONING'


  /analysis/production/definitions/{type}/{id}/reports:
    post:
      description: Generate report instance.
      parameters:
        - in: path
          name: type
          required: true
          schema:
            $ref: '#/components/schemas/ReportType'
          style: simple
          explode: false
          description: Report type
          example: AI_REASONING
        - name: id
          in: path
          description: Report definition Id.
          required: true
          schema:
            type: string
          style: simple
          explode: false
          example: a9b45451d17b4708d8ca
      responses:
        303:
          description: Redirect to the report instance.
          headers:
            Location:
              description: The report will be available over an URL address /analysis/production/definitions/a9b45451d17b4708d8ca/reports/20200414T220523
              schema:
                type: string
                example: reports/20200414T220523

  /analysis/production/definitions/{type}/{id}/reports/{timestamp}:
    get:
      description: Returns production report
      parameters:
        - in: path
          name: type
          required: true
          schema:
            $ref: '#/components/schemas/ReportType'
          style: simple
          explode: false
          description: Report type
          example: AI_REASONING
        - in: path
          name: id
          description: Report definition id.
          required: true
          schema:
            type: string
          example: a9b45451d17b4708d8ca
        - in: path
          name: timestamp
          description: Report instance timestamp. This value allows downloading a report in a specific time range (e.g. 1h since generating).
          required: true
          schema:
            type: string
          example: 20200414T220523
      responses:
        102:
          description: Processing. The report is still generating. Try again later.
        200:
          description: Returns a report.
          content:
            text/csv:
              schema:
                format: binary
                type: string

components:
  schemas:

    ReportType:
      type: string
      enum:
        - AI_REASONING
        - ACCURACY

    Report:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        title:
          type: string
        description:
          type: string
        reportType:
          $ref: '#/components/schemas/ReportType'
      example:
        - id: 'a9b45451-6fde-4832-8dc0-d17b4708d8ca'
          name: '/analysis/7afe9a43-f29c-4752-ba0a-057e5efee616/definitions/reports/a9b45451-6fde-4832-8dc0-d17b4708d8ca'
          title: 'AI Reasoning'
          description: 'Last month'
          reportType: 'AI_REASONING'

