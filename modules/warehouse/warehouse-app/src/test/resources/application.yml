spring:
  application:
    name: warehouse
  liquibase:
    enabled: false

keycloak:
  client-id: warehouse-frontend
  adapter:
    authServerUrl: fakeAuthHost:8000
    realm: sens-webapp
    publicClient: false
    confidentialPort: 0
    principalAttribute: preferred_username
    resource: backend
    sslRequired: external
    credentials.secret: 55555555-4444-3333-2222-000111000111

warehouse:
  persistence:
    alert:
      labels:
      recommendation-date-field: "recommendationDate"
  messaging:
    broker:
      analysis-expired-indexing:
        queue-name: wh.retention.analysis-expired
        routing-key: command.analysis-expired
      alert-backup-indexing:
        queue-name: wh.index-request.backup
        routing-key: command.index-request.production
      alert-production-indexing:
        queue-name: wh.index-request.production
        routing-key: command.index-request.production
      qa-indexing:
        queue-name: wh.qa-index-request
        routing-key: event.qa-alert
      alert-simulation-indexing:
        queue-name: wh.index-request.simulation
        routing-key: command.index-request.simulation
      personal-information-expired-indexing:
        queue-name: wh.retention.personal-information-expired
        routing-key: retention.personal-information-expired
      alerts-expired-indexing:
        queue-name: wh.retention.alerts-expired
        routing-key: retention.alerts-expired
      to-remove:
        bindings: []
  indexer:
    analysis-expired-indexing-inbound:
      queue-name: ${warehouse.messaging.broker.alert-production-indexing.queue-name}
    backup-indexing-inbound:
      queue-name: ${warehouse.messaging.broker.alert-backup-indexing.queue-name}
    production-indexing-inbound:
      queue-name: ${warehouse.messaging.broker.alert-production-indexing.queue-name}
    production-indexed-outbound:
      exchange-name: wh.event
      routing-key: event.index-response.production
    simulation-indexing-inbound:
      queue-name: ${warehouse.messaging.broker.alert-simulation-indexing.queue-name}
    simulation-indexed-outbound:
      exchange-name: wh.event
      routing-key: event.index-response.simulation
    personal-information-expired-indexing-inbound:
      queue-name: ${warehouse.messaging.broker.analysis-expired-indexing.queue-name.queue-name}
    alerts-expired-indexing-inbound:
      queue-name: ${warehouse.messaging.broker.alerts-expired-indexing.queue-name}
  report:
    default-bucket: reports
    copy-csv-pattern: "COPY ( %s ) TO STDOUT WITH (FORMAT CSV, HEADER)"
  db:
    host: localhost
    port: 24910
    name: warehouse
    username: warehouse
    password: warehouse
  sampling:
    time-field-name: alert_recommendationDate
sep.filestorage:
  minio:
    url: http://localhost:9000
    access-key: admin
    private-key: admin123

warehouse.report.statistics:
  all-alerts-query:
    SELECT count(*)
    FROM warehouse_simulation_alert
    WHERE analysis_name = ?
  solved-alerts-query:
    SELECT count(*)
    FROM warehouse_simulation_alert
    WHERE analysis_name = ?
    AND (payload ->> 'recommendation_recommended_action')
    IN ('ACTION_FALSE_POSITIVE', 'ACTION_POTENTIAL_TRUE_POSITIVE')
  ai-false-positive-query:
    SELECT count(*)
    FROM warehouse_simulation_alert wsa
    JOIN warehouse_alert wa ON wsa.name = wa.name
    WHERE wsa.analysis_name = ?
    AND (wa.payload ->> 'DN_CASE.currentState') IN ('Level 1 Review', 'Level 2 Review')
    AND (wsa.payload ->> 'recommendation_recommended_action') = 'ACTION_FALSE_POSITIVE'
  analyst-false-positive-query:
    SELECT count(*)
    FROM warehouse_simulation_alert wsa
    JOIN warehouse_alert wa ON wsa.name = wa.name
    WHERE wsa.analysis_name = ?
    AND (wa.payload ->> 'DN_CASE.currentState') = 'Level 1 Review'
    AND (wsa.payload ->> 'recommendation_recommended_action') = 'ACTION_FALSE_POSITIVE'
