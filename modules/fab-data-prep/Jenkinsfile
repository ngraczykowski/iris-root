@Library('pipeline-shared-library') _

gradleBuild(
    jdkVersion: 'jdk-11',
    sonarEnabled: true,
    dependencyCheckEnabled: true,
    includeBuildNumberInSnapshotVersion: true,
    archiveArtifactsPattern: '**/build/libs/*-exec.jar',
    additionalStages: {
      stage('Minio') {
        script {
          def git = new com.silenteight.jenkins.ci.Git()
          if (git.getGitBranch() == 'master') {
            minio(
                bucket: 'artifacts',
                includes: 'dataprep-app/build/libs/dataprep*-exec.jar',
                targetFolder: 'dataprep'
            )
          } else {
            echo "Not on master branch, ignore upload to Minio"
          }
        }
      }
    }
)
