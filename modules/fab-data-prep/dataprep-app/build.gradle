plugins {
  id "java"
  id "groovy"
  id "org.springframework.boot" version "2.6.4"
}

description = "dataprep-app"

configurations {
  implementation.extendsFrom starterDatabase
  runtimeOnly.extendsFrom starterDatabaseRuntime
}

apply from: "${rootProject.projectDir}/gradle/scripts/dependencies.gradle"

dependencies {
  implementation project(":dataprep-db-changelog")

  implementation libraries.silenteight_fab_cmapi_connector_api
  implementation libraries.silenteight_sep_base_common
  implementation libraries.universal_datasource_api_library
  implementation libraries.data_source_agentinput_api
  implementation libraries.data_source_categories_api
  implementation libraries.data_source_api
  implementation libraries.registration_api_proto
  implementation libraries.registration_lib
  implementation libraries.silenteight_warehouse_api
  implementation libraries.sear_rabbitmq_common_schema
  implementation libraries.spring_boot_autoconfigure
  implementation libraries.spring_boot_starter_amqp
  implementation libraries.grpc_client_spring_boot_starter
  implementation libraries.vavr
  implementation libraries.json_path
  implementation libraries.jakarta_validation_api

  // Sentry
  implementation libraries.sentry
  runtimeOnly libraries.sentry_spring_boot_starter
  runtimeOnly libraries.sentry_logback

  runtimeOnly libraries.hibernate_validator
  runtimeOnly libraries.spring_boot_starter_undertow
  runtimeOnly libraries.spring_boot_starter_actuator
  runtimeOnly libraries.grpc_brave_instrumentation
  runtimeOnly libraries.spring_cloud_starter_sleuth
  runtimeOnly libraries.spring_cloud_consul_discovery
  runtimeOnly libraries.spring_cloud_starter_consul_config

  implementation libraries.spring_boot_starter_data_jpa
  implementation libraries.spring_boot_starter_jdbc
  implementation libraries.liquibase_core
  implementation libraries.hikari_cp
  runtimeOnly libraries.postgresql
  runtimeOnly libraries.liquibase_sessionlock

  testImplementation libraries.spring_boot_test
  testImplementation libraries.spring_test
  testImplementation libraries.groovy_all
  testImplementation libraries.spock_core
  testImplementation libraries.spock_spring
  testImplementation libraries.junit_jupiter_api
  testImplementation libraries.junit_jupiter_testcontainers
  testImplementation libraries.mockito_core
  testImplementation libraries.mockito_junit_jupiter
  testImplementation libraries.testcontainers_rabbitmq
  testImplementation libraries.testcontainers_spock
  testImplementation libraries.testcontainers_postgresql
  testImplementation libraries.h2
  testRuntimeOnly libraries.junit_jupiter_engine
}

jar {
  manifest {
    attributes "Main-Class": "com.silentheight.fab.dataprep.FabDataPreparationApplication.java"
  }
}

publishing {
  publications {
    bootJava(MavenPublication) {
      artifact bootJar
    }
  }
}
