plugins {
  id "groovy"
  id "io.freefair.aspectj.post-compile-weaving"
  id "com.silenteight.iris.build.spring-boot-application"
  id "com.silenteight.iris.build.container-image"
}

description = "Firco Trust CMAPI Connector"

dependencies {
  implementation project(":ftcc-common")
  implementation project(":ftcc-callback")
  implementation project(":ftcc-db-changelog")
  implementation project(":ftcc-ingest")
  implementation project(":ftcc-request")

  // Base Libraries
  implementation libs.silenteight.sep.base.common
  implementation libs.silenteight.commons.app

  implementation libs.silenteight.registration.api.library
  implementation libs.silenteight.registration.api.proto
  implementation libs.silenteight.recommendation.api.library
  implementation libs.silenteight.recommendation.api.proto
  implementation libs.sear.rabbitmq.common.schema
  implementation libs.silenteight.fab.cmapi.connector.api

  // Utilities
  implementation libs.commons.lang3

  // Application Starters
  implementation libs.spring.boot.starter.actuator
  implementation libs.spring.boot.starter.logging
  implementation libs.spring.boot.starter.undertow
  implementation libs.spring.boot.starter.web

  // Jackson
  implementation libs.jackson.annotations
  implementation libs.jackson.databind
  runtimeOnly libs.jackson.datatype.jdk8
  runtimeOnly libs.jackson.datatype.jsr310
  runtimeOnly libs.jackson.module.afterburner
  runtimeOnly libs.jackson.module.paranamer
  runtimeOnly libs.jackson.module.parameter.names

  // Database
  implementation libs.spring.boot.starter.data.jpa
  implementation libs.spring.boot.starter.jdbc
  implementation libs.liquibase.core
  implementation libs.hikari.cp
  runtimeOnly libs.postgresql
  runtimeOnly libs.liquibase.sessionlock

  // Validator
  implementation libs.hibernate.validator

  // Messaging
  implementation libs.amqp.client
  implementation libs.lz4.java

  // gRPC
  implementation libs.grpc.api
  implementation libs.grpc.stub
  implementation libs.grpc.client.spring.boot.starter
  implementation libs.grpc.server.spring.boot.starter

  //Consul
  runtimeOnly libs.spring.cloud.consul.discovery
  runtimeOnly libs.spring.cloud.starter.consul.config

  //Prometheus
  runtimeOnly libs.micrometer.prometheus

  //Sentry
  runtimeOnly libs.sentry.spring.boot.starter
  runtimeOnly libs.sentry.logback

  testImplementation libs.silenteight.sep.base.testing
  testImplementation project(":ftcc-common-testing")
  testImplementation libs.jsonassert
  testImplementation libs.wiremock

  aspect libs.silenteight.sep.base.aspects
}

jar {
  manifest {
    attributes "Main-Class": "com.silenteight.connector.ftcc.app.FtccApplication"
  }
}
